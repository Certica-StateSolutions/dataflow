@model DataFlow.Models.Agent

@{
                /**/

                ViewBag.Title = "Add Agent";
                Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>@ViewBag.Title</h2>

@using (Html.BeginForm("Add", "Agent", FormMethod.Post, new { @class = "form-horizontal" }))
{
    @Html.Partial("_PartialAgentForm", Model)
}
@section scripts{
    <script type="text/javascript">
        $("#btnTest").click(function() {
            var url = $("#Url").val();
            var userName = $("#Username").val();
            var password = $("#Password").val();
            var directory = $("#Directory").val();
            var filePattern = $("#FilePattern").val();

            $.ajax({
                type: 'POST',
                data: {
                    url: url,
                    username: userName,
                    password: password,
                    directory: directory,
                    filePattern: filePattern
                },
                dataType: "json",
                url: '@Url.Action("TestAgentConnection", "Agent")',
                success: function(data) {
                    if (data.success === true) {
                        $("#divAgentTest").modal();
                        $("#divAgentTestResults")
                            .text("Connection to Agent successful! Found " + data.data.length + " file(s)!");
                    } else {
                        $("#divAgentTest").modal();
                        $("#divAgentTestResults")
                            .text("Unable to connect to the agent. Error: " + data.data);
                    }
                },
                fail: function(data) {
                    $("#divAgentTest").modal();
                    $("#divAgentTestResults")
                        .text("Unable to connect to the agent.");
                }
            });
        });
    </script>
}